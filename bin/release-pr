#!/bin/bash -e

if [[ -n $1 ]] ; then
	cd "$1"
fi

TARGET_BRANCH="${2:-master}"

if [[ ! -f CHANGELOG.md ]] ; then
	echo "Usage: $0 MODULE"
	exit 1
fi

VERSION="$(bundle exec rake module:version)"

git checkout --branch "release-$VERSION"
git add CHANGELOG.md metadata.json
if [[ -f HISTORY.md ]] ; then
	git add HISTORY.md
fi
git commit --message "Release $VERSION"

addfork || true
git phr --message "Release $VERSION" --base "$TARGET_BRANCH" --labels skip-changelog
